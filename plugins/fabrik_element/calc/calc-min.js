var FbCalc=new Class({Extends:FbElement,initialize:function(b,a){this.plugin="calc";this.oldAjaxCalc=null;this.parent(b,a)},attachedToForm:function(){if(this.options.ajax){var b;this.ajaxCalc=this.calc.bindWithEvent(this);var a=this.form;this.options.observe.each(function(c){if(this.form.formElements[c]){this.form.formElements[c].addNewEventAux("change",this.ajaxCalc)}else{if(this.options.canRepeat){if(this.options.isGroupJoin){b="join___"+this.options.joinid+"___"+c+"_"+this.options.repeatCounter;if(this.form.formElements[b]){this.form.formElements[b].addNewEventAux("change",this.ajaxCalc)}}else{b=c+"_"+this.options.repeatCounter;if(this.form.formElements[b]){this.form.formElements[b].addNewEventAux("change",this.ajaxCalc)}}}else{this.form.repeatGroupMarkers.each(function(e,d){b="";for(v2=0;v2<e;v2++){b="join___"+this.form.options.group_join_ids[d]+"___"+c+"_"+v2;if(this.form.formElements[b]){this.form.formElements[b].addNewEvent("change",this.ajaxCalc)}}}.bind(this))}}}.bind(this))}},calc:function(){this.element.getParent().getElement(".loader").setStyle("display","");var a=this.form.getFormElementData();var d=$H(this.form.getFormData(false));d.each(function(f,e){if(e.test(/^join\[\d+\]/)||e.test(/^fabrik_vars/)){a[e]=f}}.bind(this));$H(a).each(function(g,f){if(f.test(/join___/)){var h=f.split("_");if(h.getLast().toInt()===this.options.repeatCounter){var e=f.split("_").slice(6,-1).join("_");a[e]=g}}}.bind(this));var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"calc",method:"ajax_calc",element_id:this.options.id,formid:this.form.id};c=Object.append(a,c);var b=new Request({url:"",method:"post",data:c,onComplete:function(e){this.element.getParent().getElement(".loader").setStyle("display","none");this.update(e);if(this.options.validations){this.form.doElementValidation(this.options.element)}}.bind(this)}).send()},cloned:function(a){this.parent(a);this.attachedToForm()},update:function(a){if(this.getElement()){this.element.innerHTML=a;this.options.value=a}},getValue:function(){if(this.element){return this.options.value}return false}});