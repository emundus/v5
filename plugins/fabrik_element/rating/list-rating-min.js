var FbRatingList=new Class({options:{userid:0,mode:""},Implements:[Events,Options],initialize:function(b,a){a.element=b;this.setOptions(a);if(this.options.mode==="creator-rating"){return}this.col=$$("."+b);this.origRating={};this.col.each(function(d){var c=d.getElements(".starRating");c.each(function(e){e.addEvent("mouseover",function(f){this.origRating[d.id]=e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML.toInt();c.each(function(g){if(this._getRating(e)>=this._getRating(g)){g.src=this.options.insrc}else{g.src=this.options.outsrc}}.bind(this));e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML=e.alt}.bind(this));e.addEvent("mouseout",function(f){c.each(function(g){if(this.origRating[d.id]>=this._getRating(g)){g.src=this.options.insrc}else{g.src=this.options.outsrc}}.bind(this));e.getParent(".fabrik_element").getElement(".ratingMessage").innerHTML=this.origRating[d.id]}.bind(this))}.bind(this));c.each(function(e){e.addEvent("click",function(f){this.doAjax(f,e)}.bind(this))}.bind(this))}.bind(this))},_getRating:function(a){r=a.className.replace("rate_","").replace("starRating ","");return r.toInt()},doAjax:function(f,d){f.stop();this.rating=this._getRating(d);var h=d.getParent(".fabrik_element").getElement(".ratingMessage");Fabrik.loader.start(h);var i=new Element("div",{id:"starRatingCover",styles:{bottom:0,top:0,right:0,left:0,position:"absolute",cursor:"progress"}});var a=d.getParent(".fabrik_element").getElement("div");a.grab(i,"top");var g=document.id(d).getParent(".fabrik_row");var b=g.id.replace("list_"+document.fabrikList.elements.listref.value+"_row_","");var c={option:"com_fabrik",format:"raw",task:"plugin.pluginAjax",plugin:"rating",g:"element",method:"ajax_rate",element_id:this.options.elid,row_id:b,elementname:this.options.elid,userid:this.options.userid,rating:this.rating,mode:this.options.mode};new Request({url:"",data:c,onComplete:function(e){e=e.toInt();this.rating=e;h.set("html",this.rating);Fabrik.loader.stop(h);d.getParent(".fabrik_element").getElements("img").each(function(k,j){k.src=(j<e)?this.options.insrc:this.options.outsrc}.bind(this));document.id("starRatingCover").destroy()}.bind(this)}).send()}});