var History=new Class({initialize:function(a,b){this.recording=true;this.pointer=-1;if(document.id(a)){document.id(a).addEvent("click",function(c){this.undo(c)}.bind(this))}if(document.id(b)){document.id(b).addEvent("click",function(c){this.redo(c)}.bind(this))}Fabrik.addEvent("fabrik.history.on",function(c){this.on(c)}.bind(this));Fabrik.addEvent("fabrik.history.off",function(c){this.off(c)}.bind(this));Fabrik.addEvent("fabrik.history.add",function(c){this.add(c)}.bind(this));this.history=[]},undo:function(){if(this.pointer>-1){this.off();var b=this.history[this.pointer];var c=b.undofunc;var d=b.undoparams;var a=c.attempt(d,b.object);this.on();this.pointer--}},redo:function(){if(this.pointer<this.history.length-1){this.pointer++;this.off();var b=this.history[this.pointer];var c=b.redofunc;var d=b.redoparams;var a=c.attempt(d,b.object);this.on()}},add:function(e,d,f,b,a){if(this.recording){var c=this.history.filter(function(i,g){return g<=this.pointer}.bind(this));this.history=c;this.history.push({object:e,undofunc:d,undoparams:f,redofunc:b,redoparams:a});this.pointer++}},on:function(){this.recording=true},off:function(){this.recording=false}});