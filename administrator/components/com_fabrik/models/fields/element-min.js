var elementElement=new Class({Implements:[Options,Events],options:{plugin:"chart",excludejoined:0,value:"",highlightpk:0},initialize:function(b,a){this.el=b;this.setOptions(a);if(!this.ready()){this.cnnperiodical=this.getCnn.periodical(500,this)}else{this.setUp()}},ready:function(){if(typeOf(document.id(this.options.conn))==="null"){return false}if(typeOf(FabrikAdmin.model.fields.fabriktable)==="undefined"){return false}if(Object.getLength(FabrikAdmin.model.fields.fabriktable)===0){return false}if(Object.keys(FabrikAdmin.model.fields.fabriktable).indexOf(this.options.table)===-1){return false}return true},getCnn:function(){if(!this.ready()){return}this.setUp();clearInterval(this.cnnperiodical)},setUp:function(){var a=this.el;this.el=document.id(this.el);if(typeOf(this.el)==="null"){fconsole("element didnt find me, ",a)}var b=this.el.getParent().getElement("button");if(typeOf(b)!=="null"){b.addEvent("mousedown",function(c){c.stop();this.addPlaceHolder()}.bind(this));b.addEvent("click",function(c){c.stop()})}FabrikAdmin.model.fields.fabriktable[this.options.table].registerElement(this)},addPlaceHolder:function(){var a=this.el.getParent().getElement("select");this.insertTextAtCaret(this.el,"{"+a.get("value")+"}")},getOpts:function(){return $H({calcs:this.options.include_calculations,showintable:this.options.showintable,published:this.options.published,excludejoined:this.options.excludejoined,highlightpk:this.options.highlightpk})},cloned:function(b,a){this.el=b;var c=this.options.table.split("-");c.pop();this.options.table=c.join("-")+"-"+a;this.setUp()},getSelectionBoundary:function(c,b){var h=b?"selectionStart":"selectionEnd";var g,i,a,f,e;if(typeof c[h]==="number"){return c[h]}else{if(document.selection&&document.selection.createRange){c.focus();var d=document.selection.createRange();if(d){if(document.selection.type==="Text"){d.collapse(!!b)}g=c.value;i=c.createTextRange();a=c.createTextRange();f=0;e=d.getBookmark();i.moveToBookmark(e);if(g.indexOf("\r\n")>-1){i.text=" ";a.setEndPoint("EndToStart",i);f=a.text.length-1;document.execCommand("undo")}else{a.setEndPoint("EndToStart",i);f=a.text.length}return f}}}return 0},offsetToRangeCharacterMove:function(a,b){return b-(a.value.slice(0,b).split("\r\n").length-1)},setSelection:function(e,a,d){var c=e.createTextRange();var b=this.offsetToRangeCharacterMove(e,a);c.collapse(true);if(a===d){c.move("character",b)}else{c.moveEnd("character",this.offsetToRangeCharacterMove(e,d));c.moveStart("character",b)}c.select()},insertTextAtCaret:function(b,d){var e=this.getSelectionBoundary(b,false);var a=e+d.length;var c=b.value;b.value=c.slice(0,e)+d+c.slice(e);this.setSelection(b,a,a)}});